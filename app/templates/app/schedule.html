{% load static %}
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu·∫£n l√Ω l·ªãch b√°c sƒ© </title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
 <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f9f9f9;
            color: #333;
            padding: 5px;
        }
        h1 {
            text-align: center;
            color: #333;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        .nav-link:hover {
            background-color:  #4CAF50; /* M√†u n·ªÅn chuy·ªÉn sang ƒë·ªè khi hover */
            color: white; /* Ch·ªØ chuy·ªÉn sang m√†u tr·∫Øng */
      }
      .nav-link.active {
          color: black; /* M√†u ch·ªØ khi active */
          background-color: #4CAF50; /* M√†u n·ªÅn khi active */
          border-radius: 5px;
      }
      .footer {
        background-color:rgb(41, 95, 41); /* M√†u n·ªÅn t·ªëi */
        color: #ffffff; /* M√†u ch·ªØ tr·∫Øng */
        padding: 40px 0;
    }
    
        .footer h4 {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            text-transform: uppercase;
        }
        
        .footer ul {
            list-style: none;
            padding: 0;
        }
        
        .footer ul li {
            margin-bottom: 8px;
        }
        
        .footer ul li a {
            color: #d1d1d1;
            text-decoration: none;
            transition: color 0.3s ease;
        }
        .footer ul li a:hover {
            color: #f8f9fa; /* M√†u tr·∫Øng khi hover */
            text-decoration: underline;
        }
        
        .footer .care {
            color: #f8c291; /* M√†u nh·∫•n ƒë·∫∑c bi·ªát */
        }
        header {
            background-color:rgb(61, 207, 252);
            color: white;
            padding: 15px;
            text-align: center;
        }
        section {
            padding: 20px;
        }
        .doctor-schedule, .hospitalization, .direct-visit {
            background-color: #fff;
            margin-bottom: 20px;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        label {
            display: block;
            margin-bottom: 10px;
        }
        input, select, textarea {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 5px;
            border: 1px solid #ddd;
        }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            cursor: pointer;
            border-radius: 5px;
        }
        button:hover {
            background-color: #45a049;
        }
        #confirmation-message {
            background-color: #f0f0f0;
            padding: 20px;
            margin-top: 20px;
            border-radius: 8px;
            border: 1px solid #ddd;
            display: none;
        }
        #hospitalization-list p {
            margin: 10px 0;
        }
        .hospitalization-record {
            background-color: #f9f9f9;
            padding: 10px;
            margin: 5px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        #direct-visit-list {
            margin-top: 20px;
        }
        .direct-visit-record {
            background-color: #f9f9f9;
            padding: 10px;
            margin: 5px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .search-box {
            margin: 15px 0;
            display: flex;
            justify-content: center;
        }
        .search-box input {
            padding: 5px;
            width: 250px;
            margin-right: 10px;
        }
    </style>
</head>
<body>
<!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container-fluid">
            <a class="navbar-brand" href="{% url 'home_NV'%}">
                Staff
                <img src="{% static 'app/images/logo.png'%}" width="30" height="30" alt="Logo">
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="/booking/">Qu·∫£n l√Ω Booking</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'pet'%}">Qu·∫£n l√Ω Th√∫ c∆∞ng</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="{% url 'schedule'%}">S·∫Øp l·ªãch b√°c sƒ©</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'room'%}">Qu·∫£n l√Ω Chu·ªìng</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <div class="container mt-4">

        <h1 class="text-center">Qu·∫£n l√Ω l·ªãch b√°c sƒ©</h1>
        <div class="search-box">
            <input type="text" id="search" placeholder="T√¨m ki·∫øm theo t√™n, ID ho·∫∑c ch·ªß s·ªü h·ªØu">
        <button onclick="searchPet()">üîç T√¨m</button>
        </div>
            <!-- Ch·ªçn lo·∫°i l·ªãch h·∫πn -->
        <section class="schedule-selection">
            <h2>Ch·ªçn L·ªãch H·∫πn</h2>
            <button id="direct-visit-choice">S·∫Øp L·ªãch Kh√°m Tr·ª±c Ti·∫øp</button>
            <button id="hospitalization-choice">S·∫Øp L·ªãch ChƒÉm S√≥c Th√∫ C∆∞ng Nh·∫≠p Vi·ªán</button>
        </section>

        <!-- S·∫Øp l·ªãch cho b√°c sƒ© th√∫ y khi kh√°ch h√†ng mang th√∫ c∆∞ng ƒë·∫øn kh√°m tr·ª±c ti·∫øp -->
        <section class="direct-visit" id="direct-visit-section" style="display:none;">
            <h2>S·∫Øp L·ªãch Kh√°m Tr·ª±c Ti·∫øp</h2>
            <form id="direct-visit-form">
                <label for="customer-name-direct">T√™n kh√°ch h√†ng:</label>
        <input type="text" id="customer-name-direct" required>

                <label for="doctor-direct">Ch·ªçn b√°c sƒ©:</label>
                <select id="doctor-direct" required>
                    <option value="">Ch·ªçn b√°c sƒ©</option>
                </select>

                <label for="pet-condition-direct">T√¨nh tr·∫°ng th√∫ c∆∞ng:</label>
                <textarea id="pet-condition-direct" placeholder="M√¥ t·∫£ t√¨nh tr·∫°ng th√∫ c∆∞ng" required></textarea>

                <button type="submit">S·∫Øp L·ªãch Kh√°m</button>
            </form>

            <div id="direct-visit-list">
                <h3>Danh s√°ch l·ªãch kh√°m tr·ª±c ti·∫øp:</h3>
                <!-- Danh s√°ch kh√°m tr·ª±c ti·∫øp s·∫Ω hi·ªÉn th·ªã t·∫°i ƒë√¢y -->
            </div>
        </section>

        <!-- S·∫Øp l·ªãch cho b√°c sƒ© th√∫ y chƒÉm s√≥c th√∫ c∆∞ng nh·∫≠p vi·ªán -->
        <section class="hospitalization" id="hospitalization-section" style="display:none;">
            <h2>ChƒÉm S√≥c Th√∫ C∆∞ng Nh·∫≠p Vi·ªán</h2>
            <form id="hospitalization-form">
                <label for="customer-name-hospital">T√™n kh√°ch h√†ng:</label>
                <input type="text" id="customer-name-hospital" required>

                <label for="doctor-hospital">Ch·ªçn b√°c sƒ©:</label>
                <select id="doctor-hospital" required>
                    <option value="">Ch·ªçn b√°c sƒ©</option>
                </select>

                <label for="pet-condition-hospital">T√¨nh tr·∫°ng th√∫ c∆∞ng:</label>
                <textarea id="pet-condition-hospital" placeholder="M√¥ t·∫£ t√¨nh tr·∫°ng th√∫ c∆∞ng" required></textarea>

                <label for="pet-kennel">Chu·ªìng th√∫ c∆∞ng:</label>
                <input type="text" id="pet-kennel" placeholder="L∆∞u th√¥ng tin chu·ªìng th√∫ c∆∞ng" required>

                <button type="submit">S·∫Øp L·ªãch</button>
            </form>

            <div id="hospitalization-list">
                <h3>Danh s√°ch chƒÉm s√≥c th√∫ c∆∞ng nh·∫≠p vi·ªán:</h3>
                <!-- Danh s√°ch chƒÉm s√≥c th√∫ c∆∞ng nh·∫≠p vi·ªán s·∫Ω hi·ªÉn th·ªã t·∫°i ƒë√¢y -->
            </div>
        </section>

        <!-- X√°c nh·∫≠n l·ªãch h·∫πn -->
        <div id="confirmation-message">
            <h3>L·ªãch H·∫πn ƒê∆∞·ª£c X√°c Nh·∫≠n</h3>
            <p id="confirmation-details"></p>
            <button onclick="clearConfirmation()">ƒê√≥ng</button>
        </div>
        <div id="main-content">
            <!-- N·ªôi dung ch√≠nh c·ªßa trang -->
        </div>
        
    <script>
                // D·ªØ li·ªáu b√°c sƒ© v√† l·ªãch h·∫πn gi·∫£ l·∫≠p
        const availableDoctors = ["B√°c Sƒ© A", "B√°c Sƒ© B", "B√°c Sƒ© C"];
        const directVisitRecords = [];
        const hospitalizationRecords = [];

        // Hi·ªÉn th·ªã danh s√°ch b√°c sƒ© v√†o dropdown
        function displayAvailableDoctors() {
            const doctorDirectSelect = document.getElementById("doctor-direct");
            const doctorHospitalSelect = document.getElementById("doctor-hospital");

            // X√≥a danh s√°ch c≈© ƒë·ªÉ tr√°nh tr√πng l·∫∑p
            doctorDirectSelect.innerHTML = '<option value="">Ch·ªçn b√°c sƒ©</option>';
            doctorHospitalSelect.innerHTML = '<option value="">Ch·ªçn b√°c sƒ©</option>';

            availableDoctors.forEach(doctor => {
                doctorDirectSelect.innerHTML += `<option value="${doctor}">${doctor}</option>`;
                doctorHospitalSelect.innerHTML += `<option value="${doctor}">${doctor}</option>`;
            });
        }

        // Ki·ªÉm tra b√°c sƒ© ƒë√£ c√≥ l·ªãch h·∫πn ch∆∞a
        function isDoctorAvailable(doctor, records) {
            return !records.some(record => record.doctor === doctor);
        }

        // X·ª≠ l√Ω ƒë·∫∑t l·ªãch kh√°m tr·ª±c ti·∫øp
        document.getElementById("direct-visit-form").addEventListener("submit", function(event) {
            event.preventDefault(); // NgƒÉn form reload trang

            const customerName = document.getElementById("customer-name-direct").value;
            const doctor = document.getElementById("doctor-direct").value;
            const petCondition = document.getElementById("pet-condition-direct").value;

            if (!customerName || !doctor || !petCondition) {
                alert("Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin.");
                return;
            }

            if (!isDoctorAvailable(doctor, directVisitRecords)) {
                alert("B√°c sƒ© n√†y ƒë√£ c√≥ l·ªãch h·∫πn.");
                return;
            }

            const record = { customerName, doctor, petCondition };
            directVisitRecords.push(record);
            updateDirectVisitList();

            // Hi·ªÉn th·ªã x√°c nh·∫≠n
            showConfirmation(`L·ªãch h·∫πn kh√°m tr·ª±c ti·∫øp cho ${customerName} v·ªõi ${doctor}.`);
            
            // Reset form
            document.getElementById("direct-visit-form").reset();
        });

        // C·∫≠p nh·∫≠t danh s√°ch l·ªãch kh√°m tr·ª±c ti·∫øp
        function updateDirectVisitList() {
            const listContainer = document.getElementById("direct-visit-list");
            listContainer.innerHTML = "<h3>Danh s√°ch l·ªãch kh√°m tr·ª±c ti·∫øp:</h3>";

            directVisitRecords.forEach(record => {
                const recordElement = document.createElement("div");
                recordElement.classList.add("direct-visit-record");
                recordElement.innerHTML = `<p><strong>${record.customerName}</strong> - ${record.doctor}<br>${record.petCondition}</p>`;
                listContainer.appendChild(recordElement);
            });
        }

        // X·ª≠ l√Ω ƒë·∫∑t l·ªãch chƒÉm s√≥c th√∫ c∆∞ng nh·∫≠p vi·ªán
        document.getElementById("hospitalization-form").addEventListener("submit", function(event) {
            event.preventDefault();

            const customerName = document.getElementById("customer-name-hospital").value;
            const doctor = document.getElementById("doctor-hospital").value;
            const petCondition = document.getElementById("pet-condition-hospital").value;
            const petKennel = document.getElementById("pet-kennel").value;

            if (!customerName || !doctor || !petCondition || !petKennel) {
                alert("Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin.");
                return;
            }

            if (!isDoctorAvailable(doctor, hospitalizationRecords)) {
                alert("B√°c sƒ© n√†y ƒë√£ c√≥ l·ªãch chƒÉm s√≥c.");
                return;
            }

            const record = { customerName, doctor, petCondition, petKennel };
            hospitalizationRecords.push(record);
            updateHospitalizationList();

            showConfirmation(`L·ªãch chƒÉm s√≥c cho ${customerName} v·ªõi ${doctor} t·∫°i chu·ªìng ${petKennel}.`);

            document.getElementById("hospitalization-form").reset();
        });

        // C·∫≠p nh·∫≠t danh s√°ch chƒÉm s√≥c nh·∫≠p vi·ªán
        function updateHospitalizationList() {
            const listContainer = document.getElementById("hospitalization-list");
            listContainer.innerHTML = "<h3>Danh s√°ch chƒÉm s√≥c th√∫ c∆∞ng nh·∫≠p vi·ªán:</h3>";

            hospitalizationRecords.forEach(record => {
                const recordElement = document.createElement("div");
                recordElement.classList.add("hospitalization-record");
                recordElement.innerHTML = `<p><strong>${record.customerName}</strong> - ${record.doctor}<br>T√¨nh tr·∫°ng: ${record.petCondition}<br>Chu·ªìng: ${record.petKennel}</p>`;
                listContainer.appendChild(recordElement);
            });
        }

        // Hi·ªÉn th·ªã th√¥ng b√°o x√°c nh·∫≠n
        function showConfirmation(message) {
            const confirmationBox = document.getElementById("confirmation-message");
            document.getElementById("confirmation-details").textContent = message;
            confirmationBox.style.display = "block";
        }

        // X√≥a th√¥ng b√°o x√°c nh·∫≠n
        function clearConfirmation() {
            document.getElementById("confirmation-message").style.display = "none";
        }

        // Chuy·ªÉn sang ph·∫ßn s·∫Øp l·ªãch kh√°m tr·ª±c ti·∫øp
        document.getElementById("direct-visit-choice").addEventListener("click", function() {
            document.getElementById("direct-visit-section").style.display = "block";
            document.getElementById("hospitalization-section").style.display = "none";
        });

        // Chuy·ªÉn sang ph·∫ßn s·∫Øp l·ªãch chƒÉm s√≥c th√∫ c∆∞ng nh·∫≠p vi·ªán
        document.getElementById("hospitalization-choice").addEventListener("click", function() {
            document.getElementById("hospitalization-section").style.display = "block";
            document.getElementById("direct-visit-section").style.display = "none";
        });
        function addRecord() {
            let recordId = document.getElementById("recordId").value;
            let admissionDate = document.getElementById("admissionDate").value;
            let admissionReason = document.getElementById("admissionReason").value;
            let cageNumber = document.getElementById("cageNumber").value;
            let serviceType = document.getElementById("serviceType").value;
            let doctor = document.getElementById("doctor").value;
            
            if (!recordId || !admissionDate || !admissionReason || !cageNumber || !serviceType || !doctor) {
                alert("Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin!");
                return;
            }
            
            let table = document.getElementById("admissionTable");
            let row = table.insertRow();
            row.innerHTML = `
                <td>${recordId}</td>
                <td>${admissionDate}</td>
                <td>${admissionReason}</td>
                <td>${cageNumber}</td>
                <td>${serviceType}</td>
                <td>${doctor}</td>
                <td>
                    <button class="btn btn-warning btn-sm" onclick="editRecord(this)">S·ª≠a</button>
                    <button class="btn btn-danger btn-sm" onclick="deleteRecord(this)">X√≥a</button>
                </td>
            `;
            
            // Reset form
            document.getElementById("recordId").value = "";
            document.getElementById("admissionDate").value = "";
            document.getElementById("admissionReason").value = "";
            document.getElementById("cageNumber").value = "";
            document.getElementById("serviceType").value = "";
            document.getElementById("doctor").value = "";
        }

        function editRecord(button) {
            let row = button.closest("tr");
            let newRecordId = prompt("Nh·∫≠p m√£ h·ªì s∆° m·ªõi:", row.cells[0].innerText);
            let newDate = prompt("Nh·∫≠p ng√†y nh·∫≠p vi·ªán m·ªõi:", row.cells[1].innerText);
            let newReason = prompt("Nh·∫≠p l√Ω do nh·∫≠p vi·ªán m·ªõi:", row.cells[2].innerText);
            let newCage = prompt("Nh·∫≠p s·ªë chu·ªìng m·ªõi:", row.cells[3].innerText);
            let newService = prompt("Nh·∫≠p d·ªãch v·ª• ƒëi k√®m m·ªõi:", row.cells[4].innerText);
            let newDoctor = prompt("Nh·∫≠p b√°c sƒ© ph·ª• tr√°ch m·ªõi:", row.cells[5].innerText);
            
            if (newRecordId && newDate && newReason && newCage && newService && newDoctor) {
                row.cells[0].innerText = newRecordId;
                row.cells[1].innerText = newDate;
                row.cells[2].innerText = newReason;
                row.cells[3].innerText = newCage;
                row.cells[4].innerText = newService;
                row.cells[5].innerText = newDoctor;
            }
        }

        function deleteRecord(button) {
            if (confirm("B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a h·ªì s∆° n√†y?")) {
                button.closest("tr").remove();
            }
        }
        // H√†m t√¨m ki·∫øm th√∫ c∆∞ng theo t√™n ch·ªß s·ªü h·ªØu
        function searchPet() {
            const keyword = document.getElementById("search").value.toLowerCase().trim();
            if (!keyword) {
                alert("Vui l√≤ng nh·∫≠p t·ª´ kh√≥a t√¨m ki·∫øm!");
                return;
            }

            // K·∫øt qu·∫£ t√¨m ki·∫øm
            let searchResults = [];

            // T√¨m trong l·ªãch kh√°m tr·ª±c ti·∫øp
            directVisitRecords.forEach(record => {
                if (record.customerName.toLowerCase().includes(keyword) || record.petCondition.toLowerCase().includes(keyword)) {
                    searchResults.push({ type: "Kh√°m tr·ª±c ti·∫øp", ...record });
                }
            });

            // T√¨m trong l·ªãch nh·∫≠p vi·ªán
            hospitalizationRecords.forEach(record => {
                if (record.customerName.toLowerCase().includes(keyword) || record.petCondition.toLowerCase().includes(keyword) || record.petKennel.toLowerCase().includes(keyword)) {
                    searchResults.push({ type: "Nh·∫≠p vi·ªán", ...record });
                }
            });

            // Hi·ªÉn th·ªã k·∫øt qu·∫£ t√¨m ki·∫øm
            displaySearchResults(searchResults);
        }

        // Hi·ªÉn th·ªã k·∫øt qu·∫£ t√¨m ki·∫øm
        function displaySearchResults(results) {
            const resultContainer = document.getElementById("search-results");
            resultContainer.innerHTML = "<h3>K·∫øt qu·∫£ t√¨m ki·∫øm:</h3>";

            if (results.length === 0) {
                resultContainer.innerHTML += "<p>Kh√¥ng t√¨m th·∫•y k·∫øt qu·∫£.</p>";
                return;
            }

            results.forEach(record => {
                const recordElement = document.createElement("div");
                recordElement.classList.add("search-result");
                recordElement.innerHTML = `
                    <p><strong>${record.customerName}</strong> - ${record.type}<br>
                    B√°c sƒ©: ${record.doctor}<br>
                    T√¨nh tr·∫°ng: ${record.petCondition}${record.petKennel ? `<br>Chu·ªìng: ${record.petKennel}` : ""}</p>`;
                resultContainer.appendChild(recordElement);
            });
        }

        // Th√™m m·ªôt div ƒë·ªÉ hi·ªÉn th·ªã k·∫øt qu·∫£ t√¨m ki·∫øm
        document.addEventListener("DOMContentLoaded", function() {
            const mainContent = document.getElementById("main-content"); // ‚úÖ Ch·ªçn v·ªã tr√≠ ch√≠nh x√°c
            if (mainContent) {
                const searchResultsDiv = document.createElement("div");
                searchResultsDiv.id = "search-results";
                searchResultsDiv.style.marginTop = "20px";
                mainContent.appendChild(searchResultsDiv); // ‚úÖ Th√™m k·∫øt qu·∫£ t√¨m ki·∫øm v√†o khu v·ª±c ch√≠nh
            }
        });
        

        // G·ªçi khi trang t·∫£i xong
        window.onload = function() {
            displayAvailableDoctors();
        };
    </script>
    <footer class="footer mt-5">
        <div class="container-fluid col-10">
            <div class="row pt-3 pb-3">
                <div class="col-md-4 care">
                    <h4>ƒê√°nh Gi√° C·ªßa Kh√°ch H√†ng</h4>
                    <ul>
                        <li><a href="#">Nh·∫•n V√†o ƒê·ªÉ Xem</a></li>
                    </ul>
                </div>
                <div class="col-md-4">
                    <h4 class="care">Pet Care</h4>
                    <ul>
                        <li>Phone: 0889969020</li>
                        <li>Maps: 25 T√¥ K√Ω - T√¢n Ch√°nh Hi·ªáp - Qu·∫≠n 12</li>
                        <li>Social:</li>
                    </ul>
                </div>
                <div class="col-md-4">
                    <h4>H·ªó Tr·ª£ Kh√°ch H√†ng</h4>
                    <ul>
                        <li><a href="#">Ch√≠nh S√°ch Mua H√†ng</a></li>
                        <li><a href="#">ƒêi·ªÅu Kho·∫£n D·ªãch V·ª•</a></li>
                        <li><a href="#">H√¨nh Th·ª©c Thanh To√°n</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </footer>
</body>
</html>
